var PopularPlaces=function(e){"use strict";this.name=ko.observable(e.venue.name),this.category=ko.observable(e.venue.categories[0].name),this.address=ko.observable(e.venue.location.formattedAddress),this.rating=ko.observable(e.venue.rating),this.imgVenue=ko.observable("https://irs0.4sqi.net/img/general/100x100"+e.venue.photos.groups[0].items[0].suffix),this.venue=e.venue},appViewModel=function(){"use strict";function e(){for(var e=0;e<i.length;e++)i[e].setMap(null)}function o(e){if("undefined"!=typeof google){var o=new google.maps.LatLngBounds(new google.maps.LatLng(e.sw.lat,e.sw.lng),new google.maps.LatLng(e.ne.lat,e.ne.lng));neighborMap.fitBounds(o),neighborMap.setCenter(o.getCenter()),neighborMap.setZoom(12)}}function n(e,o){var n=e.location.address+","+e.location.city+","+e.location.country,a=e.name,t="http://maps.googleapis.com/maps/api/streetview?size=200x110&location="+n,s='<div class="venueInfowindow"><div class="venueName">'+a+'<br><p class="venue-address">'+n+'</p></div><img class="bgimg" src="'+t+'"></div>';google.maps.event.addListener(o,"click",function(){l.setContent(s),l.open(neighborMap,o)})}function a(e,o){function a(){null!==r.getAnimation()?r.setAnimation(null):(r.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){r.setAnimation(null)},1430))}var t=e.location.lat,s=e.location.lng,l=e.name,r=new google.maps.Marker({map:neighborMap,animation:o?google.maps.Animation.DROP:null,position:new google.maps.LatLng(t,s),title:l});r.addListener("click",a),i.push(r),n(e,r)}function t(e,o){for(var n in e)a(e[n],o)}var s=this,i=[];if(s.allPlaces=ko.observableArray([]),s.placeList=ko.observableArray([]),s.filterByName=ko.observable(""),this.setLocation=ko.observable("Rome"),this.setType=ko.observable("restaurant"),"undefined"!=typeof google)var l=new google.maps.InfoWindow;s.searchPlaces=function(){var n=[];e(),s.placeList([]),s.allPlaces([]);var a="&near="+s.setLocation(),i="&query="+s.setType(),l="https://api.foursquare.com/v2/venues/explore?&client_id=TSKIN0T4GWCHC5VKCHUGGJ4OZC2KLWU3MTY2E5SIIT4XYDSP&client_secret= TGXY1KT4VJLHCAYFJZ5IS5EKZWYRTE0EC1WSW11CZ2G0YT3Y&v=20150102&venuePhotos=1"+a+i;$.getJSON(l,function(e){var a=e.response.groups[0].items;o(e.response.suggestedBounds);for(var i=0;i<a.length;i++){var l=a[i];if(0!==l.venue.photos.groups.length){var r=new PopularPlaces(l);s.allPlaces.push(r),s.placeList.push(r),n.push(l.venue)}}s.placeList.sort(function(e,o){return e.rating()==o.rating()?0:e.rating()>o.rating()?-1:1}),t(n,!0)}).error(function(e){$(".venue-group").html("<h4>There is an issue in retrieving data from Foursquare</br>Please try again</h4>"),$("#map-error").append('<h4 class="mobile-error">There is an issue to retrieve data from Foursquare</br>Please try again</h4>'),console.log("fail")})},s.searchPlaces(),s.searchFiltered=function(){s.placeList.removeAll();var o=[];for(var n in s.allPlaces())s.allPlaces()[n].name().toLowerCase().indexOf(s.filterByName().toLowerCase())>=0&&(s.placeList.push(s.allPlaces()[n]),o.push(s.allPlaces()[n].venue));e(),t(o,!1)},s.filterByName.subscribe(s.searchFiltered),s.toggleSymbol=ko.observable("hide"),s.mobileToggleSymbol=ko.observable("hide"),s.listToggle=function(){"hide"===s.toggleSymbol()?s.toggleSymbol("show"):s.toggleSymbol("hide")},s.mobileListToggle=function(){"hide"===s.toggleSymbol()?s.toggleSymbol("show"):s.toggleSymbol("hide")},s.focusMarker=function(e){for(var o=e.name(),n=0;n<i.length;n++)i[n].title==o&&(google.maps.event.trigger(i[n],"click"),neighborMap.panTo(i[n].position))}},neighborMap,googleSuccess=function(){neighborMap=new google.maps.Map(document.getElementById("map-canvas"),{disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER}}),$("#map-canvas").height($(window).height()),$(document).ready(function(){ko.applyBindings(new appViewModel),console.log("Success Test")})},googleError=function(){$("#map-error").append("<h4>There is problem to retrieve data from Google Maps</br>Please try again</h4>"),$(document).ready(function(){ko.applyBindings(new appViewModel),console.log("VM Test")}),console.log("Error Test")};